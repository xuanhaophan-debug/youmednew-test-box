import React, { useState, useEffect } from 'react';
import { 
  Scale, 
  Ruler, 
  RotateCcw,
  ShieldCheck,
  ChevronDown,
  ChevronUp,
  Info,
  Calendar
} from 'lucide-react';

const App = () => {
  const [weight, setWeight] = useState('');
  const [height, setHeight] = useState('');
  const [result, setResult] = useState(null);
  const [showDisclaimer, setShowDisclaimer] = useState(true);

  useEffect(() => {
    const link = document.createElement('link');
    link.href = 'https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap';
    link.rel = 'stylesheet';
    document.head.appendChild(link);
  }, []);

  // Cấu hình màu sắc theo mức độ (Màu sắc đi theo độ nguy hiểm)
  const statusConfig = {
    0: { // Gầy
      color: "#3b82f6",
      bg: "bg-blue-50",
      border: "border-blue-100",
      header: "bg-blue-600",
      text: "text-blue-600",
    },
    1: { // Bình thường
      color: "#10b981",
      bg: "bg-emerald-50",
      border: "border-emerald-100",
      header: "bg-[#009a61]",
      text: "text-emerald-600",
    },
    2: { // Thừa cân
      color: "#f59e0b",
      bg: "bg-amber-50",
      border: "border-amber-100",
      header: "bg-amber-500",
      text: "text-amber-600",
    },
    3: { // Béo phì độ 1
      color: "#f97316",
      bg: "bg-orange-50",
      border: "border-orange-100",
      header: "bg-orange-500",
      text: "text-orange-600",
    },
    4: { // Béo phì độ 2
      color: "#ef4444",
      bg: "bg-red-50",
      border: "border-red-100",
      header: "bg-red-600",
      text: "text-red-600",
    }
  };

  const calculateBMI = () => {
    const w = parseFloat(weight);
    const hCm = parseFloat(height);
    const h = hCm / 100;

    if (!w || !h || h === 0) return;

    const bmiVal = parseFloat((w / (h * h)).toFixed(1));
    const heightSpare = hCm - 100;
    const idealW = ((heightSpare * 9) / 10).toFixed(1);

    let category = "";
    let risk = "";
    let message = "";
    let statusId = 1;

    if (bmiVal < 18.5) {
      category = "Cân nặng thấp (Gầy)";
      risk = "Nguy cơ thiếu chất";
      message = "Bạn hơi gầy một chút, hãy chú ý bồi bổ thêm nhé!";
      statusId = 0;
    } else if (bmiVal >= 18.5 && bmiVal <= 22.9) {
      category = "Dáng người cân đối";
      risk = "Rất tốt";
      message = "Tuyệt vời! Bạn đang sở hữu chỉ số hình thể rất lý tưởng.";
      statusId = 1;
    } else if (bmiVal >= 23 && bmiVal <= 24.9) {
      category = "Thừa cân nhẹ";
      risk = "Cần chú ý";
      message = "Bạn hơi thừa cân một chút, nên vận động nhẹ nhàng thường xuyên hơn.";
      statusId = 2;
    } else if (bmiVal >= 25 && bmiVal <= 29.9) {
      category = "Béo phì độ 1";
      risk = "Nguy cơ cao";
      message = "Cơ thể đang ở mức béo phì. Bạn nên điều chỉnh lại thực đơn hàng ngày.";
      statusId = 3;
    } else {
      category = "Béo phì độ 2";
      risk = "Nguy hiểm";
      message = "Mức độ béo phì này có thể ảnh hưởng xấu đến sức khỏe. Hãy tham khảo ý kiến bác sĩ.";
      statusId = 4;
    }

    setResult({ bmi: bmiVal, category, idealW, message, risk, statusId });
  };

  const currentTheme = result ? statusConfig[result.statusId] : statusConfig[1];

  const StatusLadder = ({ currentId }) => {
    const labels = [
      { name: "Gầy", range: "< 18.5", color: "bg-blue-500" },
      { name: "Bình thường", range: "18.5 - 22.9", color: "bg-emerald-500" },
      { name: "Thừa cân", range: "23.0 - 24.9", color: "bg-amber-500" },
      { name: "Béo phì độ 1", range: "25.0 - 29.9", color: "bg-orange-500" },
      { name: "Béo phì độ 2", range: "≥ 30.0", color: "bg-red-600" }
    ];

    return (
      <div className="mt-8 space-y-3">
        <p className="text-[11px] font-bold text-slate-400 uppercase tracking-widest ml-1">Bảng đối chiếu (Dành cho người Châu Á)</p>
        <div className="grid grid-cols-1 gap-2">
          {labels.map((item, idx) => {
            const isActive = currentId === idx;
            return (
              <div 
                key={idx} 
                className={`flex items-center justify-between p-4 rounded-xl border transition-all duration-500 ${
                  isActive 
                  ? `${statusConfig[idx].bg} ${statusConfig[idx].border} shadow-md scale-[1.01]` 
                  : 'border-slate-50 opacity-50 bg-slate-50/50'
                }`}
              >
                <div className="flex items-center gap-3">
                  <div className={`w-2.5 h-2.5 rounded-full ${item.color}`}></div>
                  <span className={`text-[14px] font-bold ${isActive ? 'text-slate-800' : 'text-slate-500'}`}>{item.name}</span>
                </div>
                <span className="text-[12px] font-medium text-slate-400">{item.range}</span>
              </div>
            );
          })}
        </div>
      </div>
    );
  };

  return (
    <div className="w-full max-w-[737px] mx-auto font-['Roboto',sans-serif] antialiased text-slate-800 p-4">
      <div className="bg-white rounded-[2rem] shadow-xl border border-slate-100 overflow-hidden transition-all duration-500">
        
        {/* Header - Màu thay đổi theo kết quả */}
        <div className={`${currentTheme.header} px-8 py-7 text-white flex justify-between items-center transition-colors duration-500 relative`}>
          <div className="relative z-10">
            <h1 className="text-2xl font-black tracking-tight">Kiểm tra BMI (chỉ số khối cơ thể)</h1>
            <p className="text-[11px] font-bold uppercase tracking-widest opacity-80 mt-1 flex items-center gap-2">
              <span className="w-1.5 h-1.5 bg-white rounded-full"></span>
              ĐO CHỈ SỐ CÂN NẶNG - CHIỀU CAO ONLINE
            </p>
          </div>
          <div className="bg-white/20 p-2.5 rounded-xl border border-white/20 backdrop-blur-sm">
            <ShieldCheck size={24} />
          </div>
        </div>

        <div className="p-8">
          {!result ? (
            <div className="space-y-8 animate-in fade-in slide-in-from-bottom-2 duration-500">
              <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div className="space-y-3">
                  <label className="text-xs font-bold text-slate-400 uppercase tracking-widest ml-1">Chiều cao (cm)</label>
                  <div className="relative group">
                    <Ruler className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-300 group-focus-within:text-emerald-500 transition-colors" />
                    <input 
                      type="number"
                      value={height}
                      onChange={(e) => setHeight(e.target.value)}
                      placeholder="VD: 165"
                      className="w-full pl-12 pr-5 py-5 bg-slate-50 border-2 border-transparent rounded-2xl text-lg font-bold focus:border-emerald-500 focus:bg-white outline-none transition-all"
                    />
                  </div>
                </div>
                <div className="space-y-3">
                  <label className="text-xs font-bold text-slate-400 uppercase tracking-widest ml-1">Cân nặng (kg)</label>
                  <div className="relative group">
                    <Scale className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-300 group-focus-within:text-emerald-500 transition-colors" />
                    <input 
                      type="number"
                      value={weight}
                      onChange={(e) => setWeight(e.target.value)}
                      placeholder="VD: 58"
                      className="w-full pl-12 pr-5 py-5 bg-slate-50 border-2 border-transparent rounded-2xl text-lg font-bold focus:border-emerald-500 focus:bg-white outline-none transition-all"
                    />
                  </div>
                </div>
              </div>
              
              <button 
                onClick={calculateBMI}
                className="w-full py-5 bg-slate-900 text-white rounded-2xl font-black text-sm uppercase tracking-widest shadow-lg hover:bg-black active:scale-[0.98] transition-all"
              >
                Xem kết quả ngay
              </button>
            </div>
          ) : (
            <div className="animate-in fade-in zoom-in-95 duration-500">
              {/* Card kết quả chính */}
              <div className={`${currentTheme.bg} ${currentTheme.border} rounded-[2.5rem] p-10 text-center border-2 transition-colors duration-500`}>
                <p className={`text-[11px] font-bold uppercase tracking-[0.3em] ${currentTheme.text} mb-3 opacity-60`}>Kết quả của bạn</p>
                <div className="flex justify-center items-baseline gap-1 mb-3">
                  <span className={`text-8xl font-black tracking-tighter ${currentTheme.text}`}>{result.bmi}</span>
                  <span className={`text-lg font-bold ${currentTheme.text} opacity-50`}>kg/m²</span>
                </div>
                <div className={`inline-flex items-center gap-2 px-6 py-2 bg-white rounded-full shadow-sm ${currentTheme.text} font-black text-lg mb-5 border border-current border-opacity-10`}>
                  {result.category}
                </div>
                <p className="max-w-[480px] mx-auto text-slate-600 text-base leading-relaxed font-medium">
                  "{result.message}"
                </p>
              </div>

              {/* Thông số phụ */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-5 mt-8">
                <div className="bg-slate-50 p-6 rounded-2xl border border-slate-100 flex justify-between items-center group hover:bg-white transition-all">
                  <div className="space-y-0.5">
                    <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Cân nặng nên đạt</p>
                    <p className="text-2xl font-black text-slate-700">{result.idealW} <span className="text-sm opacity-30 font-bold">kg</span></p>
                  </div>
                  <Info className="text-slate-200 group-hover:text-emerald-500 transition-colors" size={20} />
                </div>
                <div className={`p-6 rounded-2xl border flex justify-between items-center ${currentTheme.bg} ${currentTheme.border} border-opacity-40`}>
                  <div className="space-y-0.5">
                    <p className={`text-[10px] font-bold ${currentTheme.text} opacity-60 uppercase tracking-widest`}>Tình trạng sức khỏe</p>
                    <p className={`text-xl font-black ${currentTheme.text}`}>{result.risk}</p>
                  </div>
                  <ShieldCheck size={20} className={currentTheme.text} />
                </div>
              </div>

              <StatusLadder currentId={result.statusId} />

              <button 
                onClick={() => setResult(null)}
                className="w-full mt-8 py-4 bg-slate-100 text-slate-500 rounded-2xl font-bold text-xs uppercase tracking-widest hover:bg-slate-200 transition-all flex items-center justify-center gap-2"
              >
                <RotateCcw size={14} /> Kiểm tra lại
              </button>
            </div>
          )}
        </div>

        {/* Disclaimer thân thiện & Liên kết Youmed */}
        <div className="bg-slate-50/50 border-t border-slate-100 px-8 py-6">
          <div className="flex items-start gap-4">
            <div className="bg-slate-200 p-1.5 rounded-lg">
              <Info className="w-3.5 h-3.5 text-slate-500" />
            </div>
            <div className="flex-1">
              <div 
                className="flex items-center justify-between cursor-pointer group"
                onClick={() => setShowDisclaimer(!showDisclaimer)}
              >
                <h4 className="text-[11px] font-bold text-slate-500 uppercase tracking-widest group-hover:text-slate-700 transition-colors">
                  Lưu ý khi xem kết quả
                </h4>
                {showDisclaimer ? <ChevronUp size={16} className="text-slate-400" /> : <ChevronDown size={16} className="text-slate-400" />}
              </div>
              
              {showDisclaimer && (
                <div className="mt-3 text-[12px] leading-relaxed text-slate-400 font-medium animate-in fade-in duration-300">
                  <p className="mb-3">
                    Lưu ý, kết quả BMI chỉ là chỉ số tham khảo dựa trên chuẩn WHO/IDP cho người Châu Á. Không thể thay thế các phương pháp chẩn đoán chuyên sâu tại cơ sở y tế. Chỉ số không áp dụng cho phụ nữ mang thai, vận động viên chuyên nghiệp hoặc người già suy nhược cơ thể.
                  </p>
                  <div className="bg-white p-4 rounded-xl border border-slate-100 shadow-sm">
                    <p className="text-slate-500 mb-2">
                      Nếu có nhu cầu chẩn đoán chính xác tình trạng cơ thể và sức khỏe, hãy đặt lịch khám nhanh chóng tại <span className="text-blue-600 font-bold tracking-tight">app Youmed</span>.
                    </p>
                    <a 
                      href="https://bit.ly/4tbwM2W" 
                      target="_blank" 
                      rel="nofollow"
                      className="inline-flex items-center gap-2 text-[11px] font-black uppercase tracking-widest text-[#009a61] hover:underline decoration-2 underline-offset-4 transition-all"
                    >
                      <Calendar size={14} /> Đặt lịch khám ngay
                    </a>
                  </div>
                </div>
              )}
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default App;
