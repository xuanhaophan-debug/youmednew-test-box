import React, { useState, useMemo } from 'react';
import { 
  Baby, 
  ChevronRight, 
  Activity, 
  Scale, 
  Ruler, 
  Calendar,
  AlertCircle,
  CheckCircle2,
  Target,
  Heart,
  RefreshCw
} from 'lucide-react';

const App = () => {
  const [gender, setGender] = useState('boy'); 
  const [age, setAge] = useState('');
  const [weight, setWeight] = useState('');
  const [height, setHeight] = useState('');
  const [result, setResult] = useState(null);

  const theme = useMemo(() => ({
    primary: gender === 'boy' ? 'bg-indigo-600' : 'bg-rose-500',
    secondary: gender === 'boy' ? 'bg-indigo-50' : 'bg-rose-50',
    accent: gender === 'boy' ? 'text-indigo-600' : 'text-rose-600',
    ring: gender === 'boy' ? 'focus:ring-indigo-500' : 'focus:ring-rose-500',
    border: gender === 'boy' ? 'border-indigo-100' : 'border-rose-100',
  }), [gender]);

  const calculateGrowth = () => {
    const numAge = parseFloat(age);
    const numWeight = parseFloat(weight);
    const numHeight = parseFloat(height);

    if (!numAge || !numWeight || !numHeight) return;

    const hMeters = numHeight / 100;
    const bmi = (numWeight / (hMeters * hMeters)).toFixed(1);
    
    // Ngưỡng chuẩn WHO giả lập có phân biệt giới tính
    const threshold = gender === 'boy' ? { low: 14.5, high: 18.5 } : { low: 14.1, high: 18.1 };

    let status = "Bình thường";
    let color = "text-green-600";
    let bgColor = "bg-green-50";
    let message = "Tuyệt vời! Bé đang phát triển rất tốt theo biểu đồ chuẩn của WHO.";
    let type = "success";

    if (bmi < threshold.low) {
      status = "Nguy cơ Gầy còm";
      color = "text-orange-600";
      bgColor = "bg-orange-50";
      message = "Chỉ số BMI thấp. Nên bổ sung dinh dưỡng theo mục tiêu WHO 2030.";
      type = "warning";
    } else if (bmi > threshold.high) {
      status = "Nguy cơ Thừa cân";
      color = "text-red-600";
      bgColor = "bg-red-50";
      message = "Bé có dấu hiệu thừa cân. Hãy khuyến khích vận động nhiều hơn.";
      type = "danger";
    }

    setResult({
      bmi,
      status,
      color,
      bgColor,
      message,
      type,
      targets: [
        { label: "Thấp còi (Stunting)", value: "Đạt chuẩn", status: "success" },
        { label: "Gầy còm (Wasting)", value: "< 3%", status: bmi < threshold.low ? "error" : "success" },
        { label: "Thừa cân", value: "< 3%", status: bmi > threshold.high ? "error" : "success" }
      ]
    });
  };

  const reset = () => {
    setAge('');
    setWeight('');
    setHeight('');
    setResult(null);
  };

  return (
    <div className={`flex justify-center items-start min-h-screen ${theme.secondary} p-4 transition-colors duration-500`}>
      {/* Widget Container - Thiết kế gọn để chèn vào bài viết */}
      <div className="w-full max-w-md bg-white rounded-[2.5rem] shadow-2xl overflow-hidden border border-white/60">
        
        {/* Header Widget */}
        <div className={`${theme.primary} p-6 text-white text-center relative`}>
          <div className="absolute top-4 right-4 opacity-20">
             <Activity className="w-12 h-12" />
          </div>
          <h2 className="text-xl font-black tracking-tight uppercase">Kiểm tra Tăng trưởng</h2>
          <p className="text-xs text-white/80 font-medium">Tiêu chuẩn WHO & Mục tiêu 2030</p>
        </div>

        <div className="p-6 space-y-6">
          {/* Chọn giới tính */}
          <div className="flex p-1 bg-gray-100 rounded-2xl">
            <button 
              onClick={() => { setGender('boy'); setResult(null); }}
              className={`flex-1 flex items-center justify-center gap-2 py-3 rounded-xl text-sm font-bold transition-all ${gender === 'boy' ? 'bg-white shadow-md text-indigo-600' : 'text-gray-400'}`}
            >
              <Baby className="w-4 h-4" /> Bé Trai
            </button>
            <button 
              onClick={() => { setGender('girl'); setResult(null); }}
              className={`flex-1 flex items-center justify-center gap-2 py-3 rounded-xl text-sm font-bold transition-all ${gender === 'girl' ? 'bg-white shadow-md text-rose-500' : 'text-gray-400'}`}
            >
              <Heart className="w-4 h-4" /> Bé Gái
            </button>
          </div>

          {/* Form Nhập Liệu */}
          {!result && (
            <div className="space-y-4 animate-in fade-in duration-300">
              <div className="grid grid-cols-1 gap-4">
                <div className="relative">
                  <span className="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"><Calendar className="w-4 h-4"/></span>
                  <input 
                    type="number" 
                    value={age}
                    onChange={(e) => setAge(e.target.value)}
                    placeholder="Tuổi của bé (tháng)"
                    className={`w-full pl-12 pr-4 py-4 rounded-2xl bg-gray-50 border-none outline-none focus:ring-2 ${theme.ring} transition-all`}
                  />
                </div>
                <div className="relative">
                  <span className="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"><Scale className="w-4 h-4"/></span>
                  <input 
                    type="number" 
                    value={weight}
                    onChange={(e) => setWeight(e.target.value)}
                    placeholder="Cân nặng (kg)"
                    className={`w-full pl-12 pr-4 py-4 rounded-2xl bg-gray-50 border-none outline-none focus:ring-2 ${theme.ring} transition-all`}
                  />
                </div>
                <div className="relative">
                  <span className="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"><Ruler className="w-4 h-4"/></span>
                  <input 
                    type="number" 
                    value={height}
                    onChange={(e) => setHeight(e.target.value)}
                    placeholder="Chiều cao (cm)"
                    className={`w-full pl-12 pr-4 py-4 rounded-2xl bg-gray-50 border-none outline-none focus:ring-2 ${theme.ring} transition-all`}
                  />
                </div>
              </div>
              <button 
                onClick={calculateGrowth}
                className={`w-full py-4 ${theme.primary} text-white rounded-2xl font-black shadow-lg hover:opacity-90 active:scale-95 transition-all flex items-center justify-center gap-2`}
              >
                XEM KẾT QUẢ <ChevronRight className="w-5 h-5" />
              </button>
            </div>
          )}

          {/* Kết Quả Ngay Tại Chỗ */}
          {result && (
            <div className="animate-in zoom-in-95 duration-500 space-y-4">
              <div className={`${result.bgColor} p-6 rounded-3xl border border-current/10 relative overflow-hidden`}>
                <div className="flex justify-between items-start mb-2">
                  <div>
                    <p className={`text-[10px] font-black uppercase tracking-widest ${result.color} opacity-70`}>Chỉ số BMI</p>
                    <h3 className={`text-4xl font-black ${result.color}`}>{result.bmi}</h3>
                  </div>
                  <div className={`${result.color} p-2 bg-white rounded-xl shadow-sm`}>
                    {result.type === 'success' ? <CheckCircle2 /> : <AlertCircle />}
                  </div>
                </div>
                <p className={`font-bold text-sm ${result.color} mb-2`}>{result.status}</p>
                <p className="text-gray-600 text-xs leading-relaxed italic">"{result.message}"</p>
              </div>

              {/* Tóm tắt mục tiêu 2030 */}
              <div className="bg-gray-50 p-4 rounded-2xl space-y-2">
                <p className="text-[10px] font-black text-gray-400 uppercase tracking-widest flex items-center gap-1">
                  <Target className="w-3 h-3" /> Mục tiêu WHO 2030
                </p>
                {result.targets.map((t, i) => (
                  <div key={i} className="flex justify-between items-center text-xs">
                    <span className="text-gray-500">{t.label}</span>
                    <span className={`font-bold ${t.status === 'success' ? 'text-green-600' : 'text-orange-600'}`}>{t.value}</span>
                  </div>
                ))}
              </div>

              <button 
                onClick={reset}
                className="w-full py-3 bg-gray-100 text-gray-500 rounded-xl font-bold text-sm hover:bg-gray-200 transition-all flex items-center justify-center gap-2"
              >
                <RefreshCw className="w-4 h-4" /> KIỂM TRA LẠI
              </button>
            </div>
          )}
        </div>

        {/* Footer Widget */}
        <div className="bg-gray-50 p-4 text-center border-t border-gray-100">
          <p className="text-[9px] text-gray-400 font-bold uppercase tracking-tighter">
            Dữ liệu tham chiếu WHO/UNICEF Strategic Report
          </p>
        </div>
      </div>
    </div>
  );
};

export default App;
